[
  {
    "number": 157,
    "title": "如何修改storage_main的监听端口？我修改后还是端口冲突8000",
    "created_at": "2025-03-12T03:14:17Z",
    "closed_at": "2025-03-12T03:44:15Z",
    "commit_id": "3a30c53bf25c23a963aaa547098dcceff2c33baf",
    "labels": [],
    "url": "https://github.com/deepseek-ai/3FS/issues/157",
    "body": "### Issue Report\n### 标题\nstorage_main 进程在初始化时因端口冲突崩溃\n\n### 问题描述\nstorage_main 进程在初始化时崩溃，并生成了coredump文件。崩溃发生在尝试绑定到端口8000时，因为该端口已经被占用。\n\n### 环境信息\n操作系统: Ubuntu\n程序路径: /opt/3fs/bin/storage_main\n### 配置文件路径:\n/opt/3fs/etc/storage_main_launcher.toml\n/opt/3fs/etc/storage_main.toml\n### 崩溃信息\n信号: SIGABRT (Aborted)\n进程ID: 99874\n线程ID: 0x7f7c290f8b80 (LWP 99874)\n### 调用栈信息\n<TEXT>\n@ 00000000011e5aef _ZN5folly10symbolizer12_GLOBAL__N_113signalHandlerEiP9siginfo_tPv /root/3fs/3fs/third_party/folly/folly/experimental/symbolizer/SignalHandler.cpp:449\n@ 000000000004251f (unknown)\n@ 00000000000969fc pthread_kill\n@ 0000000000042475 raise\n@ 00000000000287f2 abort\n@ 000000000124c220 _ZNK5folly11LogCategory12admitMessageERKNS_10LogMessageE /root/3fs/3fs/third_party/folly/folly/logging/LogCategory.cpp:71\n@ 000000000124b6d6 _ZN5folly18LogStreamProcessor6logNowEv /root/3fs/3fs/third_party/folly/folly/logging/LogStreamProcessor.cpp:190\n@ 000000000124b929 _ZN5folly16LogStreamVoidifyILb1EEanERSo /root/3fs/3fs/third_party/folly/folly/logging/LogStreamProcessor.cpp:222\n@ 00000000022a7c48 _ZN5hf3fs19TwoPhaseApplicationINS_7storage13StorageServerEE15initApplicationEv /root/3fs/3fs/src/common/app/TwoPhaseApplication.h:59 -> /root/3fs/3fs/src/storage/storage.cpp\n@ 0000000000f79956 _ZN5hf3fs15ApplicationBase3runEiPPc /root/3fs/3fs/src/common/app/ApplicationBase.cc:65\n@ 00000000022a4a43 main /root/3fs/3fs/src/storage/storage.cpp:7\n@ 0000000000029d8f (unknown)\n@ 0000000000029e3f __libc_start_main\n@ 00000000007eb964 _start\n### 日志信息\n<TEXT>\n[2025-03-12T11:02:58.636580924+08:00 storage_main:99874 Listener.cc:102 ERROR] create socket failed: std::system_error: failed to bind to async server socket: 192.168.223.128:8000: Address already in use\n[2025-03-12T11:02:58.636735964+08:00 storage_main:99874 ServiceGroup.cc:26 ERROR] error: RPC::ListenFailed(2011)\n[2025-03-12T11:02:58.636880029+08:00 storage_main:99874 Server.cc:27 ERROR] Setup group (StorageSerde) failed: RPC::ListenFailed(2011)\n[2025-03-12T11:02:58.637110823+08:00 storage_main:99874 Server.cc:31 ERROR] Server::setup failed: RPC::ListenFailed(2011)\n[2025-03-12T11:02:58.637139597+08:00 storage_main:99874 TwoPhaseApplication.h:59 FATAL] Init server failed: RPC::ListenFailed(2011)\n### 配置信息\nmgmtd_server_addresses = [\"RDMA://192.168.223.128:8000\"] (出现在多个配置文件中)\nlisten_port = 18000 (出现在某些配置文件中)\nlisten_port = 9000 (出现在某些配置文件中)\n### 详细信息\n崩溃点: hf3fs::TwoPhaseApplication<hf3fs::storage::StorageServer>::initApplication 方法中\n### 相关代码路径:\n/root/3fs/3fs/src/common/app/TwoPhaseApplication.h:59\n/root/3fs/3fs/src/storage/storage.cpp\n/root/3fs/3fs/src/common/app/ApplicationBase.cc:65\n/root/3fs/3fs/src/storage/storage.cpp:7\n### 可能的原因\n端口冲突: 端口8000已经被其他进程占用，导致storage_main无法绑定到该端口。\n配置不一致: 配置文件中存在多个不同的listen_port设置，可能导致端口冲突。\n### 重现步骤\n启动 storage_main 进程，使用配置文件 /opt/3fs/etc/storage_main_launcher.toml 和 /opt/3fs/etc/storage_main.toml。\n",
    "comments_url": "https://api.github.com/repos/deepseek-ai/3FS/issues/157/comments",
    "author": "xiaoyaoyouyue",
    "comments": [
      {
        "user": "yuchengkang",
        "created_at": "2025-03-12T03:31:22Z",
        "body": "修改配置后需要重新执行 /opt/3fs/bin/admin_cli -cfg /opt/3fs/etc/admin_cli.toml  \"set-config --type STORAGE --file /opt/3fs/etc/storage_main.toml\""
      },
      {
        "user": "xiaoyaoyouyue",
        "created_at": "2025-03-12T03:44:13Z",
        "body": "> 修改配置后需要重新执行 /opt/3fs/bin/admin_cli -cfg /opt/3fs/etc/admin_cli.toml \"set-config --type STORAGE --file /opt/3fs/etc/storage_main.toml\"\n\n多谢，"
      }
    ],
    "satisfaction_conditions": [
      "Instructions on how to properly apply configuration changes to the storage_main service",
      "A process to ensure configuration changes take effect",
      "A solution that resolves the port conflict issue without requiring detailed debugging"
    ],
    "_classification": {
      "category": "Does not need build environment",
      "timestamp": "2025-04-14 01:02:02"
    }
  },
  {
    "number": 84,
    "title": "Why does create op need to be added in batcheop?",
    "created_at": "2025-03-04T07:19:28Z",
    "closed_at": "2025-03-04T11:38:36Z",
    "commit_id": "fc90de11107ad37512e2e0f3885be077341cb46f",
    "labels": [],
    "url": "https://github.com/deepseek-ai/3FS/issues/84",
    "body": "In my view, batch could be useful in occasion of concurrent setattr, to avoid foundation 'lock'. But how could create relative to this?",
    "comments_url": "https://api.github.com/repos/deepseek-ai/3FS/issues/84/comments",
    "author": "z47z",
    "comments": [
      {
        "user": "yiyuanliu",
        "created_at": "2025-03-04T11:09:40Z",
        "body": "For each file, 3FS selects chains from the chain table in a round-robin manner to store the file's data. By default, the counter used for round-robin selection is maintained by the meta server.\n\nThere is an optional feature (disabled by default and rarely used) where each directory maintains its own separate counter, which can be beneficial in certain scenarios. For example, when you plan to store a large amount of data in one directory and want the data to be distributed across all storage servers as evenly as possible, maintaining a separate round-robin counter for this directory might achieve better distribution than using the global counter. To reduce transaction conflicts caused by counter modification operations, we have chosen to include the create operation in the batchOp as well."
      },
      {
        "user": "z47z",
        "created_at": "2025-03-04T11:38:36Z",
        "body": "> For each file, 3FS selects chains from the chain table in a round-robin manner to store the file's data. By default, the counter used for round-robin selection is maintained by the meta server.\n> \n> There is an optional feature (disabled by default and rarely used) where each directory maintains its own separate counter, which can be beneficial in certain scenarios. For example, when you plan to store a large amount of data in one directory and want the data to be distributed across all storage servers as evenly as possible, maintaining a separate round-robin counter for this directory might achieve better distribution than using the global counter. To reduce transaction conflicts caused by counter modification operations, we have chosen to include the create operation in the batchOp as well.\n\nComprehend,thx."
      }
    ],
    "satisfaction_conditions": [
      "An explanation of the technical rationale for including create operations in batchOp",
      "Context about how the file system's chain selection mechanism works",
      "Clarification of the relationship between concurrent operations and the batchOp functionality"
    ],
    "_classification": {
      "category": "Does not need build environment",
      "timestamp": "2025-04-14 01:02:07"
    }
  },
  {
    "number": 53,
    "title": "question about the peak reading throughput of KV Cache",
    "created_at": "2025-03-03T06:26:56Z",
    "closed_at": "2025-03-03T07:13:56Z",
    "commit_id": "c69d46e7914b07dae9a14e79895da4f848d8a045",
    "labels": [],
    "url": "https://github.com/deepseek-ai/3FS/issues/53",
    "body": "The compute node just has a 1x200 Gbps NIC，so how the peak reading throughput of KV Cache can reach 40 GiB/s？\n\nDoes the KV cache storage system use the DRAM to save some hot KV Cache in the compute node？\n\nHope for your answer！Thank you！",
    "comments_url": "https://api.github.com/repos/deepseek-ai/3FS/issues/53/comments",
    "author": "DoubleEspresso-7",
    "comments": [
      {
        "user": "SF-Zhou",
        "created_at": "2025-03-03T07:05:42Z",
        "body": "The compute node for KVCache use a 1x400Gbps NIC."
      },
      {
        "user": "DoubleEspresso-7",
        "created_at": "2025-03-03T07:13:53Z",
        "body": "Thank you！Maybe you can add this information in the KV Cache part to avoid misunderstanding.\n"
      },
      {
        "user": "SF-Zhou",
        "created_at": "2025-03-03T08:21:14Z",
        "body": "> Thank you！Maybe you can add this information in the KV Cache part to avoid misunderstanding.\n\nDone!"
      }
    ],
    "satisfaction_conditions": [
      "Clarification about the network interface card (NIC) specifications for the KV Cache compute node",
      "Documentation update to include accurate hardware specifications"
    ],
    "_classification": {
      "category": "Does not need build environment",
      "timestamp": "2025-04-14 01:02:14"
    }
  }
]