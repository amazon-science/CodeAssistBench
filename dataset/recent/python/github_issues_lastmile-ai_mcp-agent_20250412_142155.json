[
  {
    "number": 45,
    "title": "[WinError 2] The system cannot find the file specified",
    "created_at": "2025-03-08T10:25:11Z",
    "closed_at": "2025-03-25T23:57:18Z",
    "commit_id": "7d1bf783b1d591aefb09b2dbbdd967e2c732aedb",
    "labels": [
      "bug"
    ],
    "url": "https://github.com/lastmile-ai/mcp-agent/issues/45",
    "body": "I'm using the example code available on the README.md, I just made some changes to add new servers (todoist and brave-search).\n\n_mcp_agents.config.yaml_\n```yaml\nmcp:\n  servers:\n    todoist:\n      command: \"npx\"\n      args: [ \"@abhiz123/todoist-mcp-server\", \"-y\"]\n    brave-search:\n      command: \"npx\"\n      args: [\"@modelcontextprotocol/server-brave-search\", \"-y\"]\n    fetch:\n      command: \"uvx\"\n      args: [\"mcp-server-fetch\"]\n\nopenai:\n  # Secrets (API keys, etc.) are stored in an mcp_agent.secrets.yaml file which can be gitignored\n  default_model: gpt-4o\n```\n\n_main.py_\n```python\nimport asyncio\n\nfrom mcp_agent.agents.agent import Agent\nfrom mcp_agent.app import MCPApp\nfrom mcp_agent.workflows.llm.augmented_llm_openai import OpenAIAugmentedLLM\n\napp = MCPApp(name=\"mcp_basic_agent\")\n\n\nasync def example_usage():\n    async with app.run() as agent_app:\n        logger = agent_app.logger\n        personal_assistant = Agent(\n            name=\"personal-assistant\",\n            instruction=\"\"\"You are a personal assistant. You are able to help the user with their queries.\"\"\",\n            server_names=[\"fetch\", \"todoist\"],\n        )\n\n        async with personal_assistant:\n            logger.info(\"personal-assistant: Connected to server, calling list_tools...\")\n            result = await personal_assistant.list_tools()\n            logger.info(\"Tools available:\", data=result.model_dump())\n\n            llm = await personal_assistant.attach_llm(OpenAIAugmentedLLM)\n            result = await llm.generate_str(\n                message=\"Show my tasks due today\",\n            )\n            logger.info(f\"Result: {result}\")\n\n\nif __name__ == \"__main__\":\n    import time\n\n    start = time.time()\n    asyncio.run(example_usage())\n    end = time.time()\n    t = end - start\n\n    print(f\"Total run time: {t:.2f}s\")\n```\n\nI had this code running on macOS and it worked. But when I try to run the same code on Windows 11, I get:\n`[ERROR] 2025-03-08T07:09:11 mcp_agent.mcp.mcp_connection_manager - todoist: Lifecycle task encountered an error: [WinError 2] The system cannot find the file specified`\n\nThe full stacktrace:\n```\nTraceback (most recent call last):\n  File \"D:\\code-projects\\ai\\mcp-agent-test\\.venv\\Lib\\site-packages\\mcp_agent\\app.py\", line 172, in run                                                                                                                          \n    yield self                                                                                                                                                                                                                  \n  File \"D:\\code-projects\\ai\\mcp-agent-test\\main.py\", line 19, in example_usage                                                                                                                                                  \n    async with personal_assistant:                                                                                                                                                                                              \n               ^^^^^^^^^^^^^^^^^^                                                                                                                                                                                               \n  File \"D:\\code-projects\\ai\\mcp-agent-test\\.venv\\Lib\\site-packages\\mcp_agent\\mcp\\mcp_aggregator.py\", line 70, in __aenter__                                                                                                     \n    await self.load_servers()                                                                                                                                                                                                   \n  File \"D:\\code-projects\\ai\\mcp-agent-test\\.venv\\Lib\\site-packages\\mcp_agent\\mcp\\mcp_aggregator.py\", line 179, in load_servers                                                                                                  \n    await self._persistent_connection_manager.get_server(                                                                                                                                                                       \n  File \"D:\\code-projects\\ai\\mcp-agent-test\\.venv\\Lib\\site-packages\\mcp_agent\\mcp\\mcp_connection_manager.py\", line 278, in get_server\n    raise RuntimeError(                                                                                                                                                                                                         \nRuntimeError: todoist: Failed to initialize server; check logs for errors.                                                                                                                                                      \n                                                                                                                                                                                                                                \nDuring handling of the above exception, another exception occurred:                                                                                                                                                             \n                                                                                                                                                                                                                                \nTraceback (most recent call last):                                                                                                                                                                                              \n  File \"D:\\code-projects\\ai\\mcp-agent-test\\main.py\", line 42, in <module>                                                                                                                                                       \n    asyncio.run(example_usage())                                                                                                                                                                                                \n  File \"C:\\Users\\Acer\\AppData\\Roaming\\uv\\python\\cpython-3.12.8-windows-x86_64-none\\Lib\\asyncio\\runners.py\", line 194, in run                                                                                                    \n    return runner.run(main)                                                                                                                                                                                                     \n           ^^^^^^^^^^^^^^^^\n  File \"C:\\Users\\Acer\\AppData\\Roaming\\uv\\python\\cpython-3.12.8-windows-x86_64-none\\Lib\\asyncio\\runners.py\", line 118, in run                                                                                                    \n    return self._loop.run_until_complete(task)                                                                                                                                                                                  \n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^                                                                                                                                                                                  \n  File \"C:\\Users\\Acer\\AppData\\Roaming\\uv\\python\\cpython-3.12.8-windows-x86_64-none\\Lib\\asyncio\\base_events.py\", line 686, in run_until_complete                                                                                 \n    return future.result()                                                                                                                                                                                                      \n           ^^^^^^^^^^^^^^^                                                                                                                                                                                                      \n  File \"D:\\code-projects\\ai\\mcp-agent-test\\main.py\", line 11, in example_usage                                                                                                                                                  \n    async with app.run() as agent_app:                                                                                                                                                                                          \n               ^^^^^^^^^\n  File \"C:\\Users\\Acer\\AppData\\Roaming\\uv\\python\\cpython-3.12.8-windows-x86_64-none\\Lib\\contextlib.py\", line 231, in __aexit__                                                                                                   \n    await self.gen.athrow(value)                                                                                                                                                                                                \n  File \"D:\\code-projects\\ai\\mcp-agent-test\\.venv\\Lib\\site-packages\\mcp_agent\\app.py\", line 174, in run                                                                                                                          \n    await self.cleanup()                                                                                                                                                                                                        \n  File \"D:\\code-projects\\ai\\mcp-agent-test\\.venv\\Lib\\site-packages\\mcp_agent\\app.py\", line 156, in cleanup                                                                                                                      \n    await cleanup_context()                                                                                                                                                                                                     \n  File \"D:\\code-projects\\ai\\mcp-agent-test\\.venv\\Lib\\site-packages\\mcp_agent\\context.py\", line 215, in cleanup_context                                                                                                          \n    await LoggingConfig.shutdown()                                                                                                                                                                                              \n  File \"D:\\code-projects\\ai\\mcp-agent-test\\.venv\\Lib\\site-packages\\mcp_agent\\logging\\logger.py\", line 240, in shutdown                                                                                                          \n    await bus.stop()\n  File \"D:\\code-projects\\ai\\mcp-agent-test\\.venv\\Lib\\site-packages\\mcp_agent\\logging\\transport.py\", line 322, in stop                                                                                                           \n    await asyncio.wait_for(self._queue.join(), timeout=5.0)                                                                                                                                                                     \n  File \"C:\\Users\\Acer\\AppData\\Roaming\\uv\\python\\cpython-3.12.8-windows-x86_64-none\\Lib\\asyncio\\tasks.py\", line 520, in wait_for                                                                                                 \n    return await fut                                                                                                                                                                                                            \n           ^^^^^^^^^                                                                                                                                                                                                            \n  File \"C:\\Users\\Acer\\AppData\\Roaming\\uv\\python\\cpython-3.12.8-windows-x86_64-none\\Lib\\asyncio\\queues.py\", line 215, in join                                                                                                    \n    await self._finished.wait()                                                                                                                                                                                                 \n  File \"C:\\Users\\Acer\\AppData\\Roaming\\uv\\python\\cpython-3.12.8-windows-x86_64-none\\Lib\\asyncio\\locks.py\", line 212, in wait\n    await fut                                                                                                                                                                                                                   \nasyncio.exceptions.CancelledError: Cancelled by cancel scope 28e9c879130\n```\nI tried only using the `fetch` MCP server, and it works. It only breaks when I add any of the others.\n\n\nI thought it was an issue with my node / npm installation, but I tried to run these MCP servers on Claude-Desktop and it worked. \n**Node version**: v23.9.0\n**npx version**:  10.9.2\n**mcp_agent**: >=0.0.8\n**python version**: 3.12.8\n\nI would appreciate any help you can give me.",
    "comments_url": "https://api.github.com/repos/lastmile-ai/mcp-agent/issues/45/comments",
    "author": "DaviRolim",
    "comments": [
      {
        "user": "saqadri",
        "created_at": "2025-03-08T20:26:45Z",
        "body": "@DaviRolim thank you for the detailed repro steps and the diligence you went through to investigate the issue yourself! I will look into this, I haven't done a ton of testing on Windows so it's possible I missed something. I'll investigate and get back to you!"
      },
      {
        "user": "saqadri",
        "created_at": "2025-03-10T02:41:08Z",
        "body": "@DaviRolim I think I know what is happening. I will test this out but I think the issue is with \"npx\". \n\nThere likely needs to be a fix in `transport_context_factory` in `MCPConnectionManager` and `ServerRegistry` classes, but can you try the following for me and let me know:\n\n1. Run `where npx` in your terminal (I think it should be C:\\Program Files\\nodejs\\npx.cmd or\nC:\\Users\\YourUsername\\AppData\\Roaming\\npm\\npx.cmd)\n2. Take the path from 1 and replace the `npx` instances in `mcp_agent.config.yaml` with the full path to npx instead\n3. Retry and see if that works. Also try just `npx.cmd`"
      },
      {
        "user": "DaviRolim",
        "created_at": "2025-03-10T11:38:40Z",
        "body": "Thank you @saqadri. Using `npx.cmd` instead of `npx` works."
      },
      {
        "user": "saqadri",
        "created_at": "2025-03-10T12:41:01Z",
        "body": "> Thank you @saqadri. Using `npx.cmd` instead of `npx` works.\n\nGreat to know! I will add some special handling in the connection manager so this can be done automatically."
      },
      {
        "user": "saqadri",
        "created_at": "2025-03-25T23:57:18Z",
        "body": "@DaviRolim @yeshan333 this has been fixed in v0.0.13. Please let me know if you run into any other issues in Windows."
      }
    ],
    "satisfaction_conditions": [
      "A working solution for running MCP servers on Windows",
      "A fix for the 'system cannot find the file specified' error when using npx on Windows",
      "Compatibility with Windows command execution conventions",
      "A solution that maintains the same functionality as on macOS"
    ],
    "_classification": {
      "category": "Can be dockerized without any issue",
      "timestamp": "2025-04-14 01:06:13"
    },
    "dockerfile": "FROM python:3.12-slim\n\n# Add labels\nLABEL maintainer=\"MCP Agent Team\"\nLABEL description=\"Environment for validating mcp-agent with Node.js MCP servers\"\n\n# Set environment variables\nENV PYTHONUNBUFFERED=1 \\\n    PYTHONDONTWRITEBYTECODE=1 \\\n    PIP_NO_CACHE_DIR=1\n\n# Install system dependencies\nRUN apt-get update && apt-get install -y --no-install-recommends \\\n    curl \\\n    git \\\n    gnupg \\\n    && rm -rf /var/lib/apt/lists/*\n\n# Install Node.js and npm\nRUN curl -fsSL https://deb.nodesource.com/setup_20.x | bash - \\\n    && apt-get install -y --no-install-recommends nodejs \\\n    && rm -rf /var/lib/apt/lists/*\n\n# Install uv (Python package manager)\nRUN pip install uv\n\n# Create app directory\nWORKDIR /app\n\n# Clone the repository and checkout the specific commit\nRUN git clone https://github.com/lastmile-ai/mcp-agent.git . \\\n    && git checkout 7d1bf783b1d591aefb09b2dbbdd967e2c732aedb\n\n# Create a virtual environment and install project dependencies with uv\nRUN uv venv && uv pip install -e .\n\n# Install Node.js MCP servers globally\nRUN npm install -g @abhiz123/todoist-mcp-server @modelcontextprotocol/server-brave-search\n\n# Install uvx for the fetch server\nRUN pip install uvicorn mcp-server-fetch\n\n# Create directory for user files\nRUN mkdir -p /app/user_files\n\n# Set working directory for user files\nWORKDIR /app/user_files\n\n# Copy example config file from the cloned repository\nRUN cp /app/examples/mcp_basic_agent/mcp_agent.config.yaml /app/user_files/mcp_agent.config.yaml\n\n# Create a placeholder secrets file (user will need to provide their own)\nRUN echo \"openai:\\n  api_key: your_api_key_here\" > /app/user_files/mcp_agent.secrets.yaml\n\n# Verify Node.js and npm versions\nRUN node --version && npm --version\n\n# Verify Python and uv versions\nRUN python --version && uv --version\n\n# The user will need to mount their code to this directory\nVOLUME [\"/app/user_files\"]"
  }
]